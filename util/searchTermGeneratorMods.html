<!doctype html>
<html lang="en" ng-app="EsConnector">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>ExileTradeModTermGenerator</title>

  <script src="https://code.jquery.com/jquery-2.2.1.min.js"></script>
  <script>

    $( document ).ready(function() {
		console.log( "ready!" );
		//$.get( "http://api.exiletools.com/endpoints/mapping?field=mods.*.explicit", function( data ) {
		  var data = "enchantMods.+20% Sweep Knockback Chance\enchantMods.+24% to Ancestral Protector Totem Elemental Resistances\enchantMods.04% of Damage Leeched as Life and Mana if you've Killed Recently\enchantMods.05% of Damage Leeched as Life and Mana if you've Killed Recently\enchantMods.1 additional Barrage Projectile\enchantMods.1 additional Flame Totem Projectile\enchantMods.1 secondary Tornado Shot Projectile\enchantMods.10% Chance to gain a Power Charge on Critical Strike with Ice Spear\enchantMods.10% increased Barrage Attack Speed\enchantMods.10% increased Cleave Attack Speed\enchantMods.10% increased Cyclone Attack Speed\enchantMods.10% increased Double Strike Attack Speed\enchantMods.10% increased Dual Strike Attack Speed\enchantMods.10% increased Elemental Hit Attack Speed\enchantMods.10% increased Heavy Strike Attack Speed\enchantMods.10% increased Leap Slam Attack Speed\enchantMods.10% increased Power Siphon Attack Speed\enchantMods.10% increased Rain of Arrows Attack Speed\enchantMods.10% increased Shield Charge Attack Speed\enchantMods.10% increased Shockwave Totem Cast Speed\enchantMods.10% increased Siege Ballista Attack Speed\enchantMods.10% increased Sunder Attack Speed\enchantMods.10% increased Whirling Blades Attack Speed\enchantMods.10% of Burning Arrow Physical Damage added as Fire Damage\enchantMods.10% of Glacial Hammer Physical Damage added as Cold Damage\enchantMods.10% of Ice Crash Physical damage added as Cold Damage\enchantMods.10% of Infernal Blow Physical damage added as Fire Damage\enchantMods.10% of Rejuvenation Totem life regeneration added as mana Regeneration\enchantMods.10% of Shrapnel Shot Physical damage added as Lightning Damage\enchantMods.10% reduced Anger Mana Reservation\enchantMods.10% reduced Determination Mana Reservation\enchantMods.10% reduced Discipline Mana Reservation\enchantMods.10% reduced Grace Mana Reservation\enchantMods.10% reduced Haste Mana Reservation\enchantMods.10% reduced Hatred Mana Reservation\enchantMods.10% reduced Mana Cost of Skills if you've been Hit Recently\enchantMods.10% reduced Wrath Mana Reservation\enchantMods.100% increased Effect of the Buff granted by your Flame Golems\enchantMods.100% increased Effect of the Buff granted by your Ice Golems\enchantMods.100% increased Effect of the Buff granted by your Stone Golems\enchantMods.100% increased Molten Shell Buff Effect\enchantMods.12% increased Ancestor Totem Placement Speed\enchantMods.12% increased Attack and Cast Speed if you've Killed Recently\enchantMods.12% increased Blast Rain Radius\enchantMods.14% reduced Mana Cost of Skills if you've been Hit Recently\enchantMods.14% reduced Purity of Elements Mana Reservation\enchantMods.14% reduced Purity of Fire Mana Reservation"

		  process(data)
		//});
	});

	function process(data) {
	  // prepare data
	  var lines = data.split('\n')
	  lines = lines.map( function (line) {
		return line.replace(/mods\..+\.explicit/i, 'mods.*.explicit')
	  })
	  lines = uniq(lines)

	  // magic
	  var mods = linesToMods(lines)
	  console.log(mods)

	  // output
	  var table = $("#table");
	  $.each(mods, function(idx, elem){
			table.append("<tr><td>"+elem.regex+"</td><td>"+elem.query+"</td></tr>");
	  });
	}

	function linesToMods(lines) {
		var mods = []
		$.each(lines, function(idx, line) {
		var mod = line.split("explicit.")[1]
		// for boolean typed mods
		// we only have 1 search term
		if (isBooleanTyped(mod)) {
		  mods.push({
			'regex' : modToRegex(mod),
			'query' : line
		  })
		} else {
		  // todo, generate 3 std here
		  // for example:
			// liferegen    			mods.*.explicit.# Life Regenerated per second:>0
			// (\d+)liferegen    		modsTotal.# Life Regenerated per second:>$1
			// (\d+)-(\d+)liferegen     modsTotal.# Life Regenerated per second:[$1 TO $2]
		  mods.push({
			'regex' : modToRegex(mod),
			'query' : line
		  })
		}
	  });
	  return mods
	}

	function modToRegex(mod) {
		mod = mod.replace(/[#%\s]/ig, "")
		return mod;
	}

    function isBooleanTyped(mod) {
		return mod.indexOf('#') != -1
	}

	function uniq(a) {
			var seen = {};
			return a.filter(function(item) {
				return seen.hasOwnProperty(item) ? false : (seen[item] = true);
			});
	}
  </script>

</head>
<body>
<!-- Main div starts at 0 spacing for simplicity -->
<div id="main" style="width:100%;padding-left:50px;padding-right:50px">
  <div>
	<table id="table">
	</table>
  </div>
</div>
</body>
</html>
